<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Coze Chat</title>
    <script>
      async function sendRequest(url, method, body) {
        const token = localStorage.getItem('token');
        const response = await fetch(url, {
          method,
          headers: {
            'Content-Type': 'application/json',
            Authorization: `Bearer ${token}`,
          },
          body: JSON.stringify(body),
        });
        return response.json();
      }

      async function createConversation() {
        const response = await sendRequest(
          'http://localhost:3366/coze/create',
          'POST',
        );
        document.getElementById('conversationId').value =
          response.conversationId;
        alert('Conversation created with ID: ' + response.conversationId);
      }

      async function deleteConversation() {
        const conversationId = document.getElementById('conversationId').value;
        await sendRequest(
          `http://localhost:3366/coze/delete/${conversationId}`,
          'DELETE',
        );
        document.getElementById('conversationId').value = '';
        alert('Conversation deleted');
      }

      async function sendMessage() {
        const message = document.getElementById('message').value;
        const conversationId = document.getElementById('conversationId').value;
        await sendRequest('http://localhost:3366/coze/sendMessage', 'POST', {
          message,
        });
        alert('Message sent');
      }

      async function createChat() {
        const response = await sendRequest(
          'http://localhost:3366/coze/createChat',
          'POST',
        );
        document.getElementById('chatId').value = response.chatId;
        alert('Chat created with ID: ' + response.chatId);
      }

      async function getChatStatus() {
        const chatId = document.getElementById('chatId').value;
        const response = await sendRequest(
          `http://localhost:3366/coze/status/${chatId}`,
          'GET',
        );
        document.getElementById(
          'status',
        ).innerText = `Status: ${response.status}`;
      }

      async function getChatMessages() {
        const chatId = document.getElementById('chatId').value;
        const response = await sendRequest(
          `http://localhost:3366/coze/messages/${chatId}`,
          'GET',
        );
        document.getElementById(
          'messages',
        ).innerText = `Messages: ${JSON.stringify(response.messages)}`;
      }
    </script>
  </head>
  <body>
    <h1>Coze Chat</h1>

    <h2>Create Conversation</h2>
    <button onclick="createConversation()">Create Conversation</button>
    <input
      type="text"
      id="conversationId"
      placeholder="Conversation ID"
      readonly
    />

    <h2>Delete Conversation</h2>
    <button onclick="deleteConversation()">Delete Conversation</button>

    <h2>Send Message</h2>
    <input type="text" id="message" placeholder="Enter message" />
    <button onclick="sendMessage()">Send</button>

    <h2>Create Chat</h2>
    <button onclick="createChat()">Create Chat</button>
    <input type="text" id="chatId" placeholder="Chat ID" readonly />

    <h2>Get Chat Status</h2>
    <button onclick="getChatStatus()">Get Status</button>
    <p id="status"></p>

    <h2>Get Messages</h2>
    <button onclick="getChatMessages()">Get Messages</button>
    <p id="messages"></p>
  </body>
</html>
